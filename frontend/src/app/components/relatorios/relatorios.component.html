<div class="relatorios-container">
  <header class="relatorios-header">
    <div class="relatorios-header-content">
      <h1 class="relatorios-titulo">
        <img src="/assets/experimenta_ai_banner_circular.webp" alt="Experimenta a√≠" class="relatorios-logo" />
        Relat√≥rios e Insights de Vendas
      </h1>
      <div class="header-actions">
        <button class="btn-header" (click)="recarregar()">üîÑ Recarregar</button>
        <button class="btn-financeiro" routerLink="/relatorio-financeiro" aria-label="Relat√≥rio Financeiro">
          üí∞ Relat√≥rio Financeiro
        </button>
        <button class="btn-voltar" routerLink="/" aria-label="Voltar para home">
          ‚Üê Voltar
        </button>
      </div>
    </div>
  </header>

  <div class="relatorios-content">
    <section class="filtros-compactos">
      <div class="datas-wrapper">
        <div class="data-referencia-wrapper">
          <label for="dataReferencia">{{ mostrarDataFim() ? 'Data in√≠cio:' : 'Data de refer√™ncia:' }}</label>
          <input
            id="dataReferencia"
            type="date"
            [value]="dataReferenciaInput()"
            (change)="alterarData($event)"
          />
        </div>
        @if (mostrarDataFim()) {
          <div class="data-fim-wrapper">
            <label for="dataFim">Data fim (opcional):</label>
            <input
              id="dataFim"
              type="date"
              [value]="dataFimInput()"
              [min]="dataReferenciaInput()"
              (change)="alterarDataFim($event)"
            />
          </div>
        }
      </div>

      <div class="granularidades">
        @for (opcao of granularidades; track opcao.id) {
          <button
            type="button"
            class="granularidade-card"
            [class.granularidade-card--ativa]="opcao.id === filtro().granularidade"
            [title]="opcao.descricao"
            (click)="alterarGranularidade(opcao.id)"
          >
            <strong>{{ opcao.label }}</strong>
          </button>
        }
      </div>
    </section>

  @if (estaCarregando()) {
    <div class="estado estado--loading">Carregando relat√≥rios...</div>
  }

  @if (erro()) {
    <div class="estado estado--erro">{{ erro() }}</div>
  }

  @if (!estaCarregando() && !erro() && !possuiDados()) {
    <div class="estado estado--vazio">
      Nenhum dado dispon√≠vel para o per√≠odo. Ajuste os filtros para visualizar os gr√°ficos.
    </div>
  }

    @if (!estaCarregando() && !erro() && possuiDados()) {
      @if (indicadores()) {
        <section class="indicadores">
          <article class="indicador-card">
            <p>Total faturado</p>
            <strong>{{ formatarMoeda(indicadores()?.totalFaturamento) }}</strong>
          </article>
          <article class="indicador-card">
            <p>Total de pedidos</p>
            <strong>{{ formatarNumero(indicadores()?.totalPedidos) }}</strong>
          </article>
          <article class="indicador-card">
            <p>Ticket m√©dio</p>
            <strong>{{ formatarMoeda(indicadores()?.ticketMedio) }}</strong>
          </article>
          <article class="indicador-card indicador-card--delta">
            <p>Crescimento vs per√≠odo anterior</p>
            <strong>{{ formatarPercentual(indicadores()?.crescimentoPercentual) }}</strong>
          </article>
        </section>
      }

      <section class="graficos-grid">
        <app-vendas-evolucao-chart [dados]="evolucaoVendas()"></app-vendas-evolucao-chart>
        <app-top-produtos-chart [dados]="produtos()"></app-top-produtos-chart>
        <app-categorias-vendas-chart [dados]="categorias()"></app-categorias-vendas-chart>
        <app-vendas-por-cliente-chart [dados]="clientes()"></app-vendas-por-cliente-chart>
        <app-quantidade-por-categoria-chart [dados]="quantidadePorCategoria()"></app-quantidade-por-categoria-chart>
        <app-vendas-por-horario-chart [dados]="horarios()"></app-vendas-por-horario-chart>
        <app-pedidos-por-horario-chart [dados]="pedidosPorHorario()"></app-pedidos-por-horario-chart>
        <app-meios-pagamento-chart [dados]="meiosPagamento()"></app-meios-pagamento-chart>
      </section>
    }
  </div>
</div>

