<div class="success-screen">
    <!-- Header com bot√£o voltar -->
    <div class="success-header">
        <button class="btn-minimizar-status" (click)="continuarNavegando.emit()">
            <span class="btn-minimizar-icon">‚Äπ</span>
            <span>Continuar navegando</span>
        </button>
    </div>

    <div class="success-content">
        @if (sucesso().pedidoCancelado()) {
            <!-- Pedido cancelado/rejeitado -->
            <div class="success-card cancelado">
                <div class="success-icon cancelado">‚ùå</div>
                <h2>Pedido Cancelado</h2>
                <p class="success-main">Infelizmente seu pedido foi cancelado.</p>
                @if (sucesso().statusPedido()?.motivoCancelamento) {
                    <p class="motivo-cancelamento">
                        Motivo: {{ sucesso().statusPedido()?.motivoCancelamento }}
                    </p>
                }
            </div>
        } @else {
            <!-- Pedido em andamento -->
            <div class="success-card">
                <div class="success-icon-wrapper">
                    <div class="success-icon" [class.pulsing]="!sucesso().pedidoFinalizado()">
                        @if (sucesso().pedidoFinalizado()) {
                            üéâ
                        } @else if (sucesso().statusAtual() === 'SAIU_PARA_ENTREGA') {
                            üõµ
                        } @else if (sucesso().passoAtual() === 2) {
                            @if (sucesso().statusAtual() === 'ACEITO') {
                                ‚è≥
                            } @else {
                                üë®‚Äçüç≥
                            }
                        } @else {
                            üçΩÔ∏è
                        }
                    </div>
                </div>

                @if (sucesso().numeroPedido()) {
                    <div class="numero-pedido-badge">
                        Pedido #{{ sucesso().numeroPedido() }}
                    </div>
                }

                <h2 class="success-titulo">{{ sucesso().statusDescricao() }}</h2>

                <div class="success-mesa-info">
                    <span class="mesa-icon">üìç</span>
                    <span>Mesa {{ mesaNumero() }}</span>
                </div>
            </div>

            <!-- Timeline de status -->
            <div class="success-timeline">
                <!-- Passo 1: Pedido enviado (sempre completo) -->
                <div class="timeline-step completed">
                    <div class="timeline-marker">
                        <span class="timeline-icon">‚úì</span>
                    </div>
                    <div class="timeline-content">
                        <span class="timeline-label">Pedido enviado</span>
                    </div>
                </div>

                <!-- Passo 2: Aguardando confirma√ß√£o -->
                <div class="timeline-step"
                     [class.completed]="sucesso().passoAtual() > 1"
                     [class.active]="sucesso().passoAtual() === 1">
                    <div class="timeline-marker">
                        @if (sucesso().passoAtual() > 1) {
                            <span class="timeline-icon">‚úì</span>
                        } @else {
                            <span class="timeline-icon waiting">‚è≥</span>
                        }
                    </div>
                    <div class="timeline-content">
                        <span class="timeline-label">Confirma√ß√£o</span>
                        @if (sucesso().passoAtual() === 1) {
                            <span class="timeline-sublabel">Aguardando atendente</span>
                        }
                    </div>
                </div>

                <!-- Passo 3: Em prepara√ß√£o -->
                <div class="timeline-step"
                     [class.completed]="sucesso().passoAtual() > 2"
                     [class.active]="sucesso().passoAtual() === 2"
                     [class.pending]="sucesso().passoAtual() < 2">
                    <div class="timeline-marker">
                        @if (sucesso().passoAtual() > 2) {
                            <span class="timeline-icon">‚úì</span>
                        } @else if (sucesso().passoAtual() === 2) {
                            @if (sucesso().statusAtual() === 'ACEITO') {
                                <span class="timeline-icon waiting">‚è≥</span>
                            } @else {
                                <span class="timeline-icon cooking">üë®‚Äçüç≥</span>
                            }
                        } @else {
                            <span class="timeline-icon pending">‚óã</span>
                        }
                    </div>
                    <div class="timeline-content">
                        <span class="timeline-label">Prepara√ß√£o</span>
                        @if (sucesso().passoAtual() === 2) {
                            @if (sucesso().statusAtual() === 'ACEITO') {
                                <span class="timeline-sublabel">Pedido confirmado. Aguardando iniciar preparo</span>
                            } @else {
                                <span class="timeline-sublabel">Seu pedido est√° sendo preparado</span>
                            }
                        }
                    </div>
                </div>

                <!-- Passo 4: Pronto -->
                <div class="timeline-step"
                     [class.completed]="sucesso().passoAtual() > 3"
                     [class.active]="sucesso().passoAtual() === 3"
                     [class.pending]="sucesso().passoAtual() < 3">
                    <div class="timeline-marker">
                        @if (sucesso().passoAtual() > 3) {
                            <span class="timeline-icon">‚úì</span>
                        } @else if (sucesso().passoAtual() === 3) {
                            <span class="timeline-icon done">‚úÖ</span>
                        } @else {
                            <span class="timeline-icon pending">‚óã</span>
                        }
                    </div>
                    <div class="timeline-content">
                        <span class="timeline-label">Pronto!</span>
                        @if (sucesso().passoAtual() === 3) {
                            <span class="timeline-sublabel">Iremos servir em breve</span>
                        }
                    </div>
                </div>

                <!-- Passo 5: Saiu para entrega (sempre mostra ap√≥s PRONTO) -->
                <div class="timeline-step"
                     [class.completed]="sucesso().passoAtual() > 4"
                     [class.active]="sucesso().passoAtual() === 4"
                     [class.pending]="sucesso().passoAtual() < 4">
                    <div class="timeline-marker">
                        @if (sucesso().passoAtual() > 4) {
                            <span class="timeline-icon">‚úì</span>
                        } @else if (sucesso().passoAtual() === 4) {
                            <span class="timeline-icon delivery">üõµ</span>
                        } @else {
                            <span class="timeline-icon pending">‚óã</span>
                        }
                    </div>
                    <div class="timeline-content">
                        <span class="timeline-label">Saiu para entrega</span>
                        @if (sucesso().passoAtual() === 4) {
                            <span class="timeline-sublabel">Seu pedido est√° a caminho</span>
                        }
                    </div>
                </div>

                <!-- Passo 6: Finalizado (apenas se status for FINALIZADO) -->
                @if (sucesso().statusAtual() === 'FINALIZADO' || sucesso().passoAtual() >= 5) {
                    <div class="timeline-step completed">
                        <div class="timeline-marker">
                            <span class="timeline-icon done">üéâ</span>
                        </div>
                        <div class="timeline-content">
                            <span class="timeline-label">Finalizado</span>
                            <span class="timeline-sublabel">Pedido conclu√≠do com sucesso!</span>
                        </div>
                    </div>
                }
            </div>

            <!-- Info adicional -->
            @if (!sucesso().pedidoFinalizado()) {
                <div class="success-tempo">
                    <span class="tempo-icon">‚è±Ô∏è</span>
                    <span>{{ sucesso().formatarTempoEspera() }}</span>
                </div>
            }
        }
    </div>

    <!-- A√ß√µes -->
    <div class="success-actions">
        @if (sucesso().pedidoTerminado()) {
            <button class="btn-novo-pedido" (click)="novoPedido.emit()">
                üõí Fazer Novo Pedido
            </button>
        } @else {
            <p class="aguardando-finalizacao">
                Voc√™ pode continuar navegando enquanto aguarda
            </p>
        }
    </div>
</div>
